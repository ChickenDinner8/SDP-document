# 软件设计文档

---

## 1.前端

### 1.1 顾客点餐系统

#### 1.1.1 技术选型理由

在微信开发者工具以及小程序开发文件结构目录的基础下，我们使用了WeUI框架。

  -  WeUI是由微信官方设计团队专为微信移动 Web 应用设计的 UI 库；
  -  WeUI是一套同微信原生视觉体验一致的基础样式库，令用户的使用感知更加统一；
  -  WeUI相比于原生提供了更丰富与实用的组件；
  -  WeUI的部署方法简单，使用体验也比较便捷。

#### 1.1.2 架构设计

在小程序客户端，文件目录主要包含一个描述整体程序的 app 和多个描述各自页面的 page。

小程序主体部分由三个文件组成，需要放在项目的根目录，如下:

- app.js：小程序的逻辑
- app.json：小程序的公共设置
- app.wxss：小程序的公共样式表

而每一个小程序页面由四个文件组成，分别是：

- .js文件：页面逻辑文件，逻辑层由 JavaScript 编写，涵盖页面跳转，网络请求，内容载入等代码部分，将数据进行处理后发送给视图层，同时接受视图层的事件反馈
- .wxml文件：页面结构文件，描述页面布局与内容，属于小程序的视图层
- .wxss文件：页面样式表，是对于页面结构文件的修饰与UI细节的表达，也属于小程序的视图层
- .json文件：页面配置，主要描述页面的基础配置参数，例如页面标题与标题颜色等

最后生成的整体文件目录如下：

![ ](https://github.com/ChickenDinner8/ChickenDinner8.github.io/blob/master/public/img/pomelo/content.jpg?raw=true)

其中，pages文件夹下存放了所有的小程序页面的信息，每个页面又有四个文件构成。

#### 1.1.3 模块划分

#### 1.1.4 软件设计技术

### 1.2 商家管理系统

#### 1.2.1 技术选型理由

**Vue.js:**

- Vue是一个轻巧、高性能、可组件化的MVVM库，并且拥有非常容易上手的API； 
- Vue 的核心库只关注视图层，并且非常容易学习，非常容易与其它库或已有项目整合；
- Vue 完全有能力驱动采用单文件组件和 Vue 生态系统支持的库开发的复杂单页应用；
- Vue 也支持响应式、双向数据绑定等 MVVM 特性，能够很好地支持丰富的用户交互体验。

**IView：**

- iView 是一套基于 Vue.js 的开源 UI 组件库，主要服务于 PC 界面的中后台产品；
- iView具有友好的 API ，能够自由灵活地使用空间，并且支持自定义主题。

**axios**

- axios 是一个基于Promise 用于浏览器和 nodejs 的 HTTP 客户端 
- axios是一个ajax的封装，是vue.js2.0之后官方推荐的ajax插件，相对于之前官方推荐的vue-resource，axios有着更大的适用性，不仅可以使用在客户端，也可以使用在服务器端，也拥有更加简单实用的API。

**webpack：**

- 当下前端最流行的构建打包工具，利用 webpack 搭配相应的 loader，可以在前端项目中使用 es6 进行开发，效率更高，开发完成后，webpack 还可以将代码编译到 es5 以兼容大部分浏览器；

#### 1.2.2 架构设计

在商家端项目中，我们主要分为以下的包：

- build：开发环境和项目构建的代码 
- config：项目进行webpack打包时依照的配置
- src：项目源码，里面又主要分为
  - assets：存放项目资源文件
  - components：项目中自定义的组件
  - router：项目路由配置
- dist：打包生成的产品文件

`build`包根据`config`中的配置调整webpack打包规则，将`src`中的源码进行打包。另外，项目构建后，还会生成`dist`包，为构建后的产品文件。 

![](https://github.com/ChickenDinner8/SDP-document/blob/master/Assets/Merchant-end/package.png?raw=true)

#### 1.2.3 模块划分

商家端管理系统前端分为6个页面：

- Login:：商家登录页面
- RestaurantInfo：商家信息页面（待开发）
- Menu：菜单管理页面
- Order：查看订单页面
- QRcode：定制餐桌二维码页面
- Setting：个人设置页面（待开发）



采取单页面Web应用的思想，将网页的各个部分抽象为一个个组件，在一个页面内通过组件的切换，实现各种跳转功能，组件设计及功能如下：

- Addwindow.vue：添加菜品的弹窗组件，商家在此弹窗输入菜品名称、菜品描述、菜品定价，以及上传菜品图片
- Dish.vue：用于显示每个菜品的组件，包括菜品名称、菜品描述、菜品描述和菜品销量，以及对应的图片
- Editwindow.vue：修改菜品信息的弹窗组件，商家在此弹窗对菜品名称、菜品描述、菜品定价或菜品图片进行修改
- Home.vue：主页组件，在此渲染导航栏等UI布局，并为其它组件的切换提供router入口
- Login.vue：登录页面组件，商家在此通过输入用户名及密码登录进入点餐系统
- Menu.vue：菜单管理页面组件，商家在此对菜单上的菜品进行增、删、改操作
- Order.vue：订单管理页面组件，商家在此可查看订单信息
- QRcode.vue：二维码页面组件，商家在此页面输入



组件间的包含关系如下：

—— Login.vue

—— Home.vue

​	—— Menu.vue

​		—— Addwindow.vue

​		—— Dish.vue

​			—— Editwindow.vue

​	—— Order.vue

​	—— QRcode.vue



实现时用到了父子组件间的传值：

1）添加菜品时，作为子组件的添加菜品弹窗将数据向父组件菜单页面组件进行传递，同时父组件向子组件传递数据，将商家上一次的操作内容清空；

2）修改菜品时，作为子组件的修改菜品弹窗将数据向父组件菜品组件进行传递，修改父组件中显示的菜品信息，同时父组件向子组件传递数据进行同步，使得在下一次点开修改菜品信息窗口时，显示修改后的菜品信息。



#### 1.2.4 软件设计技术

**MVVM**

MVVM是Model-View-ViewModel的简写。它本质上就是MVC 的改进版。MVVM 就是将其中的View 的状态和行为抽象化，让我们将视图 UI 和业务逻辑分开。

MVVM的思路是给view里面的各种控件也定义一个对应的数据对象，这样，只要修改这个数据对象，view里面显示的内容就自动跟着刷新，而在view 里做了任何操作，这个数据对象也跟着自动更新。具体说明如下：

　　ViewModel：与界面(view)对应的Model。因为数据库结构往往是不能直接跟界面控件一一对应上的，所以，需要再定义一个数据对象专门对应view上的控件。而ViewModel的职责就是把model对象封装成可以显示和接受输入的界面数据对象。

　　简单的说，ViewModel就是View与Model的连接器，View与Model通过ViewModel实现双向绑定。



**组件化设计思想与单文件组件文件组织方法**

Vue框架一个重要的思想就是将页面各个部分组件化，并尽可能将复用率较高的部分再继续抽离出来，写成一个独立的组件，再在其它组件内嵌套调用，简化代码，也能提高变成的效率。

进行文件组织时，使用单文件组件的组织形式，每一个组件以一个单独的.vue文件进行封装，并且将组件的样式、逻辑等代码，一并封装到同一个文件内，可以大大方便组件的管理和拓展。



## 2. 服务端

### 2.1 技术选型理由

本节阐述了本团队在进行软件设计时所考虑的因素

1. 首先考虑简单性，简单的设计可以降低复杂度，放松对开发人员技术水平的要求，同时也增强了软件的可靠性
2. 第二是可维护性，在面对可维护性强的代码时，开发人员不仅可以较为轻松地理解代码，还能在修改代码的同时最小化此次修改对软件的冲击
3. 第三是可拓展性，可拓展的设计允许开发人员方便地为软件添加功能或增强性能
4. 第四是健壮性，软件在运行时能够容忍一定的错误
5. 最后是性能，软件有较快的响应速度和处理速度

### 2.2 架构设计

- 基于简单性的考虑，本项目采用浏览器/服务器架构
- 为了提高开发效率，同时增强代码的可维护性和可拓展性，本项目采取了前后端分离的架构模式
- 由于REST API的可拓展性和健壮性比较强，服务端的API采用了这种设计

综上所述，前端的顾客端以微信小程序的形式开发，前端的餐厅端以Web页面的形式开发，而服务端则以Django框架为依托向前端提供REST API服务

### 2.3 模块划分
服务端的模块划分：大体上分为登录、控制器、数据对象、静态文件服务、配置五类模块

- 登陆模块负责用户的登录认证，代码由auth_required_decorator.py组成
- 控制器模块负责处理URL请求，代码由urls.py以及各个以"_ctrl"为后缀的python代码文件组成
- 数据对象负责数据库数据到对象之间的映射，代码由models.py组成
- 静态文件服务主要由nginx的Docker镜像构成，模块由Dockerfile_nginx、nginx_app.conf以及各项静态文件等组成
- 配置模块负责配置服务器的运行状态、与外部数据库的连接、Travis的使用、Docker镜像的构建等，模块由settings.py、.travis.yml和docker-compose.yml等文件组成

### 2.4 软件设计技术

- 结构化程序设计，一个例子是控制器模块的代码
- RESTful API， 参见urls.py
- 容器化技术，参见docker-compose.yml